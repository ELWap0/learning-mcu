#include <stdint.h>

uint32_t freq = 4e6;

void setup(){
  //enable gate
  RCC->APB2ENR |= RCC_APB2ENR_USART1EN;
  //configure pin to use UART functionality
  GPIOA->MODER &= ~(GPIO_MODER_MODE9_Msk|GPIO_MODER_MODE9_Msk);
  GPIOA->MODER |= ((0b10U << GPIO_MODER_MODE9_Pos) | ( 0b10U << GPIO_MODER_MODE10_Pos));
  GPIOA->OSPEEDR &= ~(GPIO_OSPEEDR9_Msk | GPIO_OSPEEDR10_Msk);
  GPIOA->OSPEEDR |= (0b01U << GPIO_OSPEEDR9_Pos | 0b01U << GPIO_OSPEEDR10_Msk);
  GPIOA->AFR[1] &= ~(GPIO_AFRH_AFSEL9_Msk |GPIO_AFRH_AFSEL10_Msk)
}

void delayMs(uint32_t ms){
  int32_t tick = freq/1000;
  for(uint32_t x = 0; x < ms; x++){
    for(uint32_t tickCounter = 0; tickCounter < tick; tickCounter++);
  }
}


int main(){
  setup();
  char test[] = "hello";
  while(true){
    for(int i = 0; i < sizeof(test); i++){
      USART->TDR = test[i];
    }
    delayMs(1000);
  }
}
 
